/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[23],{500:function(ya,ua,n){n.r(ua);var pa=n(0),na=n(9),ma=n(3);ya=n(48);var ka=n(25),ja=n(13);n=function(){function ha(){this.init()}ha.prototype.init=function(){this.yda=!1;this.zf=this.um=this.connection=null;this.Nt={};this.ga=this.lI=null};ha.prototype.xwa=function(aa){for(var y=this,r=0;r<aa.length;++r){var f=aa[r];switch(f.at){case "create":this.Nt[f.author]||(this.Nt[f.author]=f.aName);this.Xla(f);break;case "modify":this.ga.pp(f.xfdf).then(function(a){y.ga.ub(a[0])});
break;case "delete":this.ga.pp("<delete><id>"+f.aId+"</id></delete>")}}};ha.prototype.Xla=function(aa){var y=this;this.ga.pp(aa.xfdf).then(function(r){r=r[0];r.authorId=aa.author;y.ga.ub(r);y.ga.trigger(na.c.UPDATE_ANNOTATION_PERMISSION,[r])})};ha.prototype.wla=function(aa,y,r){this.um&&this.um(aa,y,r)};ha.prototype.preloadAnnotations=function(aa){this.addEventListener("webViewerServerAnnotationsEnabled",this.wla.bind(this,aa,"add",{imported:!1}),{once:!0})};ha.prototype.initiateCollaboration=function(aa,
y,r){var f=this;if(aa){f.zf=y;f.ga=r.ma();r.addEventListener(na.g.DOCUMENT_UNLOADED,function(){f.disableCollaboration()});f.Xwa(aa);var a=new XMLHttpRequest;a.addEventListener("load",function(){if(200===a.status&&0<a.responseText.length)try{var b=JSON.parse(a.responseText);f.connection=exports.da.Ixa(Object(ka.k)(f.zf,"blackbox/"),"annot");f.lI=b.id;f.Nt[b.id]=b.user_name;f.ga.sQ(b.id);f.connection.VAa(function(h){h.t&&h.t.startsWith("a_")&&h.data&&f.xwa(h.data)},function(){f.connection.send({t:"a_retrieve",
dId:aa});f.trigger(ha.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[f.Nt[b.id],f.lI])},function(){f.disableCollaboration()})}catch(h){Object(ma.g)(h.message)}});a.open("GET",Object(ka.k)(this.zf,"demo/SessionInfo.jsp"));a.withCredentials=!0;a.send();f.yda=!0;f.ga.o4(function(b){return f.Nt[b.Author]||b.Author})}else Object(ma.g)("Document ID required for collaboration")};ha.prototype.disableCollaboration=function(){this.um&&(this.ga.removeEventListener(ja.a.Events.ANNOTATION_CHANGED,this.um),this.um=
null);this.connection&&this.connection.hr();this.ga&&this.ga.sQ("Guest");this.init();this.trigger(ha.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ha.prototype.Xwa=function(aa){var y=this;this.um&&this.ga.removeEventListener(ja.a.Events.ANNOTATION_CHANGED,this.um);this.um=function(r,f,a){return Object(pa.b)(this,void 0,void 0,function(){var b,h,e,w,x,z,ca,ba,fa;return Object(pa.d)(this,function(ea){switch(ea.label){case 0:if(a.imported)return[2];b={t:"a_"+f,dId:aa,annots:[]};return[4,y.ga.UX()];
case 1:h=ea.ba();"delete"!==f&&(e=(new DOMParser).parseFromString(h,"text/xml"),w=new XMLSerializer);for(x=0;x<r.length;x++)z=r[x],ba=ca=void 0,"add"===f?(ca=e.querySelector('[name="'+z.Id+'"]'),ba=w.serializeToString(ca),fa=null,z.InReplyTo&&(fa=y.ga.Of(z.InReplyTo).authorId||"default"),b.annots.push({at:"create",aId:z.Id,author:y.lI,aName:y.Nt[y.lI],parent:fa,xfdf:"<add>"+ba+"</add>"})):"modify"===f?(ca=e.querySelector('[name="'+z.Id+'"]'),ba=w.serializeToString(ca),b.annots.push({at:"modify",aId:z.Id,
xfdf:"<modify>"+ba+"</modify>"})):"delete"===f&&b.annots.push({at:"delete",aId:z.Id});0<b.annots.length&&y.connection.send(b);return[2]}})})}.bind(y);this.ga.addEventListener(ja.a.Events.ANNOTATION_CHANGED,this.um)};ha.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ha}();Object(ya.a)(n);ua["default"]=n}}]);}).call(this || window)
